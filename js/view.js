function updateVotes(e){document.querySelectorAll(".wl-reaction-item").forEach(((t,o)=>{const s=t.querySelector(".wl-reaction-votes");if(s){s.classList.remove("my-view");const t="view"+(o+1);e.hasOwnProperty(t)&&(s.textContent=e[t]),e.hasOwnProperty("my_view")&&Number(e.my_view)===o+1&&s.classList.add("my-view")}}))}function sendPostRequest(e,t,o){const s={address:e,ip:t,view:o},n=document.querySelector(".wl-reaction-item.clicked").querySelector(".wl-reaction-votes");n.classList.add("view_loading"),fetch("https://hexo-view.pupper.cn/insert/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((e=>e.json())).then((e=>{updateVotes(e),n.classList.remove("view_loading")})).catch((e=>{console.error("Error:",e),n.classList.remove("view_loading")}))}function sendGetRequest(e,t){var o=document.querySelectorAll(".wl-reaction-votes");o.forEach((e=>{e.classList.add("view_loading")})),fetch("https://hexo-view.pupper.cn/read/?address="+encodeURIComponent(e)+"&ip="+encodeURIComponent(t)).then((e=>e.json())).then((e=>{updateVotes(e)})).catch((e=>{console.error("Error:",e)})).finally((()=>{o.forEach((e=>{e.classList.remove("view_loading")}))}))}const address=window.location.href;let ip="";function setIP(){return fetch("https://api.ipify.org?format=json").then((e=>e.json())).then((e=>{ip=e.ip})).catch((e=>{console.error("获取 IP 地址失败:",e),ip="127.4.0.4"}))}setIP().then((()=>{console.log(ip)}));const liElements=document.querySelectorAll(".wl-reaction-item");liElements.forEach(((e,t)=>{e.addEventListener("click",(()=>{const o="view"+(t+1);console.log(address,ip,o);const s=document.querySelector(".wl-reaction-item.clicked");s&&s.classList.remove("clicked"),e.classList.add("clicked"),sendPostRequest(address,ip,o)}))})),window.addEventListener("DOMContentLoaded",(()=>{sendGetRequest(address,ip)}));