const axios=require("axios"),fs=require("fs"),yaml=require("js-yaml"),cheerio=require("cheerio"),key="********",steamid="********";async function getSteamData(e,a){const t=`http://api.steampowered.com/IPlayerService/GetOwnedGames/v1?include_appinfo=true&key=${e}&steamid=${a}&skip_unvettend_apps=false&include_played_free_games%3D1=true&format=json`;return(await axios.get(t)).data.response.games}async function getAchievementData(e,a,t){const s=`https://api.steampowered.com/ISteamUserStats/GetPlayerAchievements/v0001/?appid=${e}&key=${a}&steamid=${t}&l=zh_CN`;return(await axios.get(s)).data}function loadYamlFile(e){return yaml.safeLoad(fs.readFileSync(e,"utf8"))}function saveYamlFile(e,a){fs.writeFileSync(e,yaml.safeDump(a,{noRefs:!0,indent:"    "}),"utf8")}async function baike(e){const a=`https://baike.baidu.com/search/word?fromModule=lemma_search-box&word=${e}`,t=await axios.get(a),s=cheerio.load(t.data)("title").text().split("_")[0];return s||e}async function main(e){const a=await getSteamData(key,steamid),t=loadYamlFile(e);let s=t[0].steam[0].games_list;for(let e=0;e<a.length;e++){const t=a[e];e>=s.length&&s.push({}),s[e].en_name=t.name||"",s[e].name=await baike(t.name||"");const i=t.appid;if(!i){console.log("appid 不存在");break}s[e].link=`https://store.steampowered.com/app/${i}`,s[e].img=`https://cdn.cloudflare.steamstatic.com/steam/apps/${i}/header.jpg`,s[e].totalTime=Math.round(t.playtime_forever/60*100)/100+" 小时",s[e].lastTime=t.rtime_last_played?new Date(1e3*t.rtime_last_played).toISOString().split("T")[0]:"从未运行";const n=await getAchievementData(i,key,steamid),o=n.playerstats?n.playerstats.achievements:[],l=o.filter((e=>1===e.achieved)).length;s[e].num=`${l}/${o.length}`,s[e].achievement=(o.length>0?Math.round(l/o.length*100*100)/100:0)+"%",console.log(`完成进度: ${e+1} / ${a.length}, 游戏名:${t.name}`)}saveYamlFile(e,t)}main("source/_data/games.yml");